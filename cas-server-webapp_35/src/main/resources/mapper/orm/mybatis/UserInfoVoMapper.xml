<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.gonetbar.ssa.entity.UserInfoVoMapper">
	
	<resultMap id="findUserByVoId_resultmap" type="userInfoVo">
		<result column="id_user" property="id_user" />
		<result column="username" property="username" />
		<result column="password" property="password" />
		<result column="nikename" property="nikename" />
		<result column="id_site" property="id_site" />
		<result column="logintype" property="logintype" />
		<result column="validtype" property="validtype" />
		<result column="encrypttype" property="encrypttype" />
		<result column="thirdloginid" property="thirdloginid" />
		<result column="email" property="email" />
	</resultMap>

	<resultMap id="findUserByProviderTypeId_resultmap" type="userProviderInfoVo">
		<result column="providertype" property="providertype" />
		<result column="providerid" property="providerid" />
		<result column="username" property="username" />
		<result column="createdate" property="createdate" />
	</resultMap>

	<resultMap id="queryUserAuthoritiesId_resultmap" type="aclGrantedAuthority">
		<result column="role_key" property="role" />
		<result column="id_user" property="userid" />
		<result column="id_role" property="roleid" />
		<result column="role_status" property="rolestatus" />
	</resultMap>	
	
	<select id="findUserByVoId" parameterType="userInfoVo" resultMap="findUserByVoId_resultmap">
		select
			t.id_user,
			t.username,
			t.password,
			t.nikename,
			t.id_site,
			t.logintype,
			t.validtype,
			t.createdate,
			t.encrypttype,
			t.thirdloginid,
			t.email
		from
			sso_user t
		where
			t.username = #{username}
	</select>

	<select id="findUserByProviderTypeId" parameterType="userProviderInfoVo" resultMap="findUserByProviderTypeId_resultmap">
		select
			t.providertype,
			t.providerid,
			t.username,
			t.createdate
		from
			sso_user_third t
		where
			t.providertype = #{providertype}
		and t.providerid = #{providerid}
	</select>

	<select id="queryUserAuthoritiesId" parameterType="userInfoVo" resultMap="queryUserAuthoritiesId_resultmap">
		SELECT
			ur.id_user,
			ur.id_role,
			r.role_key,
			r.role_status
		FROM
			sso_sys_user_role AS ur,
			sso_sys_role AS r
		WHERE
			ur.id_role = r.id_role
		AND r.role_status
		AND ur.id_user = #{id_user}
		ORDER BY
			ur.orderno ASC,
			r.role_sort ASC
	</select>


</mapper>